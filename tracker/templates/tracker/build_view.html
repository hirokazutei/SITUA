{% extends 'tracker/base.html' %}

{% block title %} Buildings {% endblock %}

{% block body %}

<h1>Building View</h1>
<h2>{{ building.name }} : {{ building.association }}</h2>
{% load staticfiles %}
<img src={% static building.image.url %} alt="Building's Image" class="img-responsive img-rounded"\>

{% if message %}
    <p><strong>{{ message }}</strong></p>
{% endif %}
    {% csrf_token %}
    <!--<div class="table-responsive">-->
    <table class="table table-hover">
        <tr>
            <th>Event No.</th>
            <th>Validity</th>
            <th>Event Time</th>
            <th>Intensity</th>
            <th>Predominant Period</th>
            <th>Error Status</th>
            <th>Edit Event</th>
            <th>Process Data</th>
        </tr>
    {% for event in building.event_set.all %}
        <label for="event{{ forloop.counter }}">
            <tr class="Events">
                <td>{{ event.pk }}</td>
                {% if event.error %}
                    <td><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></td>
                {% else %}
                    <td><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></td>
                {% endif %}
                <td>{{ event.event_time }}</td>
                <td>{{ event.intensity }}</td>
                {% if event.predominant_period > 0 %}
                    <td>{{ event.predominant_period }}</td>
                {% else %}
                    <td>NOT PROCESSED</td>
                {% endif %}
                <td><a href="{% url 'tracker:change_error' buildingpk=building.pk eventpk=event.pk %}"><button type="button"
                    class="btn btn-default">
                    Change</button></a></td>
                <td><a href="{% url 'tracker:event_edit' buildingpk=building.pk pk=event.pk %}"><button type="button"
                    class="btn btn-default">
                    Process</button></a></td>
                <td><a href="{% url 'tracker:process_data' buildingpk=building.pk eventpk=event.pk %}"><button type="button"
                    class="btn btn-default">
                    Process</button></a></td>
            </tr>
        </label><br>
    {% endfor %}
</table>
{% endblock %}

<form action="{% url 'tracker:set_error' building.pk %}" method="post">
        <!--this tag is a convenient way to avoid cross site scripting-->
            {% csrf_token %}
            {% if error %}
                <h2>There was an error: {{error}}</h2>
            {% else %}
                {% for event in building.event_set.all %}
                <!--name dictates the variable in the POST data-->
                <!--avoided using forloop.counter since I want to display each event's key value-->
                    <input type="radio" name="Event" id="event{{ event.pk }}" value="{{ event.pk }}" />
                    <label for="event{{ event.pk }}">Event {{ event.pk }}</label><br />
                {% endfor %}
            {% endif %}
        <input type="submit" value="error" />
        </form>